{% extends "base.html" %}

{% block title %}{{ service.name }} - DownDetector Clone{% endblock %}

{% block content %}
<div class="container-fluid">
    <!-- Back Navigation -->
    <nav aria-label="breadcrumb" class="mb-3">
        <ol class="breadcrumb">
            <li class="breadcrumb-item">
                <a href="{{ url_for('main.dashboard') }}" class="text-decoration-none">
                    <i data-feather="home" class="me-1"></i>Home
                </a>
            </li>
            <li class="breadcrumb-item active">{{ service.name }}</li>
        </ol>
    </nav>

    <div class="row justify-content-center">
        <div class="col-lg-8">
            <!-- Service Header -->
            <div class="text-center mb-5">
                {% if service.icon_path %}
                <div class="mb-4">
                    <img src="{{ url_for('static', filename=service.icon_path) }}" 
                         alt="{{ service.name }} logo" 
                         style="width: 120px; height: 120px; object-fit: contain; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.15);">
                </div>
                {% endif %}
                
                <!-- Status Message -->
                {% set status = service.get_status() %}
                {% set recent_count = service.get_recent_reports_count() %}
                
                <h1 class="mb-4" style="font-size: 2.5rem; font-weight: 300; line-height: 1.2;">
                    {% if status == 'up' and recent_count == 0 %}
                        User reports indicate no current problems at {{ service.name }}
                    {% elif status == 'up' %}
                        {{ service.name }} is experiencing minor issues
                    {% elif status == 'issues' %}
                        Some users are experiencing issues with {{ service.name }}
                    {% else %}
                        {{ service.name }} is currently experiencing an outage
                    {% endif %}
                </h1>
                
                <!-- Star Rating -->
                <div class="mb-4">
                    <div class="d-flex justify-content-center align-items-center">
                        <div class="me-3">
                            {% for i in range(5) %}
                            <i data-feather="star" class="star-rating {% if i < 4 %}text-warning{% else %}text-muted{% endif %}" 
                               style="width: 24px; height: 24px; fill: {% if i < 4 %}currentColor{% else %}none{% endif %};"></i>
                            {% endfor %}
                        </div>
                        <small class="text-muted">
                            How satisfied are you with {{ service.name }}?<br>
                            Vote to express your opinion!
                        </small>
                    </div>
                </div>
                
                <!-- Action Buttons -->
                <div class="mb-5">
                    <button type="button" class="btn btn-danger btn-lg me-3" data-bs-toggle="modal" data-bs-target="#reportModal" style="min-width: 150px;">
                        <i data-feather="alert-triangle" class="me-2"></i>
                        Report a Problem
                    </button>
                    <button type="button" class="btn btn-outline-primary btn-lg" style="min-width: 150px;">
                        <i data-feather="bell" class="me-2"></i>
                        Follow Status
                    </button>
                </div>
            </div>

            <!-- 24 Hour Chart Section -->
            <div class="mb-5">
                <h3 class="mb-4">{{ service.name }} outages reported in the last 24 hours</h3>
                <div class="card">
                    <div class="card-body" style="min-height: 300px;">
                        <canvas id="reportsChart" style="max-height: 250px;"></canvas>
                    </div>
                </div>
                
                <div class="mt-3">
                    <p class="text-muted" style="font-size: 0.9rem; line-height: 1.6;">
                        This chart shows a view of problem reports submitted in the past 24 hours compared to the typical volume of reports by time of day. 
                        It is typical to see reports increase during periods of peak usage. 
                        When the number of reports exceeds our baseline, represented by the red line, we determine that a service disruption is occurring.
                    </p>
                </div>
            </div>

            <!-- Problem Types Section -->
            <div class="row mb-5">
                <div class="col-md-6">
                    <div class="card">
                        <div class="card-body">
                            <h5 class="card-title mb-4">Most reported problems</h5>
                            <div class="problem-stats">
                                <div class="d-flex justify-content-between align-items-center mb-3">
                                    <span>Connection issues</span>
                                    <div class="d-flex align-items-center">
                                        <div class="progress me-2" style="width: 100px; height: 8px;">
                                            <div class="progress-bar bg-danger" style="width: 51%"></div>
                                        </div>
                                        <strong>51%</strong>
                                    </div>
                                </div>
                                <div class="d-flex justify-content-between align-items-center mb-3">
                                    <span>Login problems</span>
                                    <div class="d-flex align-items-center">
                                        <div class="progress me-2" style="width: 100px; height: 8px;">
                                            <div class="progress-bar bg-warning" style="width: 32%"></div>
                                        </div>
                                        <strong>32%</strong>
                                    </div>
                                </div>
                                <div class="d-flex justify-content-between align-items-center">
                                    <span>Loading issues</span>
                                    <div class="d-flex align-items-center">
                                        <div class="progress me-2" style="width: 100px; height: 8px;">
                                            <div class="progress-bar bg-info" style="width: 17%"></div>
                                        </div>
                                        <strong>17%</strong>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="card">
                        <div class="card-body">
                            <h5 class="card-title mb-4">Live outage map</h5>
                            <div id="map" style="height: 200px; border-radius: 8px;"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Stay Informed Section -->
            <div class="card mb-5" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
                <div class="card-body text-white text-center py-4">
                    <h4 class="mb-3">Stay informed</h4>
                    <p class="mb-4">Be the first to know when {{ service.name }} experiences an outage</p>
                    <div class="d-flex justify-content-center gap-3">
                        <a href="#" class="btn btn-dark">
                            <i data-feather="smartphone" class="me-2"></i>
                            Download App
                        </a>
                        <a href="#" class="btn btn-outline-light">
                            <i data-feather="bell" class="me-2"></i>
                            Get Notifications
                        </a>
                    </div>
                </div>
            </div>

            <!-- Social Media Reports -->
            <div class="mb-5">
                <h4 class="mb-4">{{ service.name }} social media reports</h4>
                <div class="card">
                    <div class="card-body">
                        <div id="socialReports">
                            <div class="d-flex align-items-start mb-4">
                                <div class="flex-shrink-0">
                                    <div class="bg-primary rounded-circle d-flex align-items-center justify-content-center" style="width: 40px; height: 40px;">
                                        <i data-feather="twitter" class="text-white" style="width: 20px; height: 20px;"></i>
                                    </div>
                                </div>
                                <div class="flex-grow-1 ms-3">
                                    <div class="d-flex align-items-center mb-1">
                                        <strong class="me-2">@user123</strong>
                                        <small class="text-muted">2 hours ago</small>
                                    </div>
                                    <p class="mb-0">{{ service.name }} seems to be down for me. Anyone else having issues? #{{ service.name.lower() }}down</p>
                                </div>
                            </div>
                            
                            <div class="d-flex align-items-start">
                                <div class="flex-shrink-0">
                                    <div class="bg-primary rounded-circle d-flex align-items-center justify-content-center" style="width: 40px; height: 40px;">
                                        <i data-feather="twitter" class="text-white" style="width: 20px; height: 20px;"></i>
                                    </div>
                                </div>
                                <div class="flex-grow-1 ms-3">
                                    <div class="d-flex align-items-center mb-1">
                                        <strong class="me-2">@techuser</strong>
                                        <small class="text-muted">4 hours ago</small>
                                    </div>
                                    <p class="mb-0">Is {{ service.name }} working for anyone? Getting connection errors since this morning.</p>
                                </div>
                            </div>
                        </div>
                        <div class="text-center mt-4">
                            <button class="btn btn-outline-primary">Show more posts</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    </div>
</div>

<!-- Report Modal -->
<div class="modal fade" id="reportModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Report Issue with {{ service.name }}</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <form id="reportForm">
                <div class="modal-body">
                    <div class="mb-3">
                        <label for="location" class="form-label">Location (Optional)</label>
                        <input type="text" class="form-control" id="location" placeholder="e.g., New York, USA">
                    </div>
                    <div class="mb-3">
                        <label for="description" class="form-label">Problem Description</label>
                        <textarea class="form-control" id="description" rows="3" 
                                placeholder="Describe the issue you're experiencing..." required></textarea>
                    </div>
                    <div class="mb-3">
                        <button type="button" class="btn btn-outline-secondary btn-sm" id="getLocationBtn">
                            <i data-feather="map-pin" class="me-1"></i>
                            Use My Location
                        </button>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="submit" class="btn btn-primary">Submit Report</button>
                </div>
            </form>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    const SERVICE_ID = {{ service.id }};
    const SERVICE_NAME = "{{ service.name }}";
</script>
<script src="{{ url_for('static', filename='js/service-detail.js') }}"></script>
{% endblock %}
